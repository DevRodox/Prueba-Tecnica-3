import{_ as v,r as y,c as g,w as E,a,b as t,e as x,v as w,f as D,t as m,h as C,o as l,u as P,m as S,F as h,j as f,n as U,p as F,q as N,d as k,k as j,l as M}from"./index-CH_ZDy35.js";const V={name:"ProjectForm",props:{initialData:{type:Object,default:()=>({})}},emits:["submit"],setup(n,{emit:s}){const d=y({name:"",description:"",status:1}),e=g(()=>n.initialData&&!!n.initialData.id);return E(()=>n.initialData,i=>{const o=i||{};d.value={name:o.name||"",description:o.description||"",status:o.status||1}},{immediate:!0}),{form:d,isEdit:e,handleSubmit:()=>{s("submit",{...d.value})}}}},I={class:"text-right"},q={type:"submit",class:"bg-blue-600 text-white px-4 py-2 rounded"};function z(n,s,d,e,c,i){return l(),a("form",{onSubmit:s[3]||(s[3]=C((...o)=>e.handleSubmit&&e.handleSubmit(...o),["prevent"])),class:"space-y-4"},[t("div",null,[s[4]||(s[4]=t("label",{class:"block text-sm font-medium text-gray-700"},"Nombre del proyecto",-1)),x(t("input",{"onUpdate:modelValue":s[0]||(s[0]=o=>e.form.name=o),type:"text",class:"w-full border p-2 rounded",required:""},null,512),[[w,e.form.name]])]),t("div",null,[s[5]||(s[5]=t("label",{class:"block text-sm font-medium text-gray-700"},"Descripción",-1)),x(t("textarea",{"onUpdate:modelValue":s[1]||(s[1]=o=>e.form.description=o),class:"w-full border p-2 rounded",rows:"3"},null,512),[[w,e.form.description]])]),t("div",null,[s[7]||(s[7]=t("label",{class:"block text-sm font-medium text-gray-700"},"Estado",-1)),x(t("select",{"onUpdate:modelValue":s[2]||(s[2]=o=>e.form.status=o),class:"w-full border p-2 rounded",required:""},s[6]||(s[6]=[t("option",{value:"1"},"En desarrollo",-1),t("option",{value:"2"},"Finalizado",-1),t("option",{value:"3"},"Cancelado",-1),t("option",{value:"4"},"En pausa",-1)]),512),[[D,e.form.status]])]),t("div",I,[t("button",q,m(e.isEdit?"Guardar cambios":"Crear proyecto"),1)])],32)}const L=v(V,[["render",z]]),B={name:"AssignUsersModal",props:{projectId:{type:Number,required:!0}},emits:["close","success"],setup(n,{emit:s}){const d=P(),e=y([]),c=y(!0),i=g(()=>d.getters["users/assignableUsers"]);return S(async()=>{try{await d.dispatch("users/fetchAssignableUsers")}catch{alert("Error al obtener usuarios")}finally{c.value=!1}}),{users:i,selected:e,loading:c,handleSubmit:async()=>{try{await U(n.projectId,e.value),s("success"),s("close")}catch{alert("Error al asignar usuarios")}}}}},T={class:"bg-white p-6 rounded-lg shadow-lg w-full max-w-md relative"},G={key:0,class:"text-gray-500"},O={key:0,class:"text-gray-500"},H={key:1,class:"max-h-60 overflow-y-auto"},J=["value"],K={class:"text-right mt-4"};function Q(n,s,d,e,c,i){return l(),a("div",T,[s[4]||(s[4]=t("h2",{class:"text-lg font-bold mb-4"},"Asignar usuarios al proyecto",-1)),e.loading?(l(),a("div",G,"Cargando usuarios...")):(l(),a("form",{key:1,onSubmit:s[2]||(s[2]=C((...o)=>e.handleSubmit&&e.handleSubmit(...o),["prevent"])),class:"space-y-4"},[e.users.length===0?(l(),a("div",O,"No hay usuarios disponibles.")):(l(),a("div",H,[(l(!0),a(h,null,f(e.users,o=>(l(),a("label",{key:o.id,class:"block text-sm text-gray-700 my-1"},[x(t("input",{type:"checkbox",value:o.id,"onUpdate:modelValue":s[0]||(s[0]=u=>e.selected=u),class:"mr-2"},null,8,J),[[N,e.selected]]),F(" "+m(o.name)+" ("+m(o.role)+") ",1)]))),128))])),t("div",K,[s[3]||(s[3]=t("button",{type:"submit",class:"bg-blue-600 text-white px-4 py-2 rounded hover:bg-blue-700"}," Asignar ",-1)),t("button",{type:"button",class:"ml-2 text-gray-500 hover:text-black",onClick:s[1]||(s[1]=o=>n.$emit("close"))}," Cancelar ")])],32))])}const R=v(B,[["render",Q]]),W={name:"ProjectsList",components:{ProjectForm:L,AssignUsersModal:R},setup(){const n=P(),s=g(()=>n.getters["projects/allProjects"]),d=g(()=>n.state.projects.loading),e=g(()=>n.state.projects.error),c=y(!1),i=y(null),o=y(!1),u=y(null),r=()=>n.dispatch("projects/fetchProjects");S(()=>{r()});const b=()=>{i.value=null,c.value=!0},A=p=>{i.value=p,c.value=!0},_=()=>{c.value=!1,i.value=null};return{projects:s,loading:d,error:e,showModal:c,showAssignModal:o,editingProject:i,selectedProjectId:u,openCreateModal:b,openEditModal:A,closeModal:_,handleFormSubmit:async p=>{try{i.value?await n.dispatch("projects/updateProject",{id:i.value.id,data:p}):await n.dispatch("projects/createProject",p),await r(),_()}catch{alert("Error al guardar proyecto")}},handleDelete:async p=>{confirm("¿Eliminar este proyecto?")&&(await n.dispatch("projects/deleteProject",p),await r())},openAssignModal:p=>{u.value=p,o.value=!0},closeAssignModal:()=>{u.value=null,o.value=!1},fetchProjects:r}}},X={class:"p-6"},Y={class:"flex justify-between items-center mb-4"},Z={key:0,class:"text-gray-500"},$={key:1,class:"text-red-500"},ee={key:2},te={class:"w-full bg-white shadow rounded overflow-hidden"},se={class:"px-4 py-2"},oe={class:"px-4 py-2"},ae={class:"px-4 py-2 capitalize"},le={class:"px-4 py-2 text-sm"},ne={class:"list-disc list-inside text-gray-600"},re={class:"px-4 py-2 text-center flex justify-center gap-2 flex-wrap"},ie=["onClick"],de=["onClick"],ce=["onClick"],ue={key:3,class:"fixed inset-0 bg-black/70 flex items-center justify-center z-20"},me={class:"bg-white p-6 rounded-lg shadow-lg w-full max-w-lg relative"},pe={class:"text-lg font-bold mb-4"},be={key:4,class:"fixed inset-0 bg-black/70 flex items-center justify-center z-20"};function ye(n,s,d,e,c,i){const o=M("ProjectForm"),u=M("AssignUsersModal");return l(),a("div",X,[t("div",Y,[s[2]||(s[2]=t("h1",{class:"text-2xl font-bold"},"Proyectos",-1)),t("button",{onClick:s[0]||(s[0]=(...r)=>e.openCreateModal&&e.openCreateModal(...r)),class:"bg-green-600 text-white px-4 py-2 rounded hover:bg-green-700"}," + Crear proyecto ")]),e.loading?(l(),a("div",Z,"Cargando proyectos...")):e.error?(l(),a("div",$,m(e.error),1)):(l(),a("div",ee,[t("table",te,[s[3]||(s[3]=t("thead",{class:"bg-gray-100 text-left text-sm uppercase"},[t("tr",null,[t("th",{class:"px-4 py-2"},"Nombre"),t("th",{class:"px-4 py-2"},"Descripción"),t("th",{class:"px-4 py-2"},"Estado"),t("th",{class:"px-4 py-2"},"Usuarios"),t("th",{class:"px-4 py-2 text-center"},"Acciones")])],-1)),t("tbody",null,[(l(!0),a(h,null,f(e.projects,r=>(l(),a("tr",{key:r.id,class:"border-t hover:bg-gray-50"},[t("td",se,m(r.name),1),t("td",oe,m(r.description),1),t("td",ae,m(r.statusLabel),1),t("td",le,[t("ul",ne,[(l(!0),a(h,null,f(r.users,b=>(l(),a("li",{key:b.id},m(b.name),1))),128))])]),t("td",re,[t("button",{onClick:b=>e.openEditModal(r),class:"text-blue-600 text-sm hover:underline"}," Editar ",8,ie),t("button",{onClick:b=>e.openAssignModal(r.id),class:"text-purple-600 text-sm hover:underline"}," Asignar usuarios ",8,de),t("button",{onClick:b=>e.handleDelete(r.id),class:"text-red-600 text-sm hover:underline"}," Eliminar ",8,ce)])]))),128))])])])),e.showModal?(l(),a("div",ue,[t("div",me,[t("h2",pe,m(e.editingProject?"Editar proyecto":"Crear nuevo proyecto"),1),j(o,{initialData:e.editingProject,onSubmit:e.handleFormSubmit},null,8,["initialData","onSubmit"]),t("button",{onClick:s[1]||(s[1]=(...r)=>e.closeModal&&e.closeModal(...r)),class:"absolute top-2 right-3 text-gray-600 text-xl hover:text-black"}," × ")])])):k("",!0),e.showAssignModal?(l(),a("div",be,[j(u,{projectId:e.selectedProjectId,onClose:e.closeAssignModal,onSuccess:e.fetchProjects},null,8,["projectId","onClose","onSuccess"])])):k("",!0)])}const we=v(W,[["render",ye]]);export{we as default};

const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/index-CH_ZDy35.js","assets/index-BlOjq0s8.css"])))=>i.map(i=>d[i]);
import{_ as y,r as f,c as w,w as U,a as d,b as o,d as g,e as c,v as b,f as S,g as P,t as p,h as C,o as i,i as E,F as D,j as V,k as h,l as k,u as F,m as q}from"./index-CH_ZDy35.js";const N={name:"UserForm",props:{initialData:{type:Object,default:()=>({})}},setup(a,{emit:e}){const n=f({name:"",last_name:"",second_last_name:"",email:"",role:"",password:""}),t=w(()=>a.initialData&&!!a.initialData.id);return U(()=>a.initialData,u=>{const s=u||{};n.value={name:s.name||"",last_name:s.last_name||"",second_last_name:s.second_last_name||"",email:s.email||"",role:s.role||"",password:""}},{immediate:!0}),{form:n,isEdit:t,handleSubmit:()=>{e("formSubmit",{...n.value})}}}},I=["disabled"],j={key:0},A={class:"text-right"},L={type:"submit",class:"bg-blue-600 text-white px-4 py-2 rounded"};function R(a,e,n,t,r,u){return i(),d("form",{onSubmit:e[6]||(e[6]=C((...s)=>t.handleSubmit&&t.handleSubmit(...s),["prevent"])),class:"space-y-4",autocomplete:"off"},[o("div",null,[e[7]||(e[7]=o("label",{class:"block text-sm font-medium text-gray-700"},"Nombre",-1)),c(o("input",{"onUpdate:modelValue":e[0]||(e[0]=s=>t.form.name=s),type:"text",class:"w-full border p-2 rounded",required:""},null,512),[[b,t.form.name]])]),o("div",null,[e[8]||(e[8]=o("label",{class:"block text-sm font-medium text-gray-700"},"Correo",-1)),c(o("input",{"onUpdate:modelValue":e[1]||(e[1]=s=>t.form.email=s),type:"email",class:"w-full border p-2 rounded",required:"",disabled:t.isEdit},null,8,I),[[b,t.form.email]])]),o("div",null,[e[9]||(e[9]=o("label",{class:"block text-sm font-medium text-gray-700"},"Apellido paterno",-1)),c(o("input",{"onUpdate:modelValue":e[2]||(e[2]=s=>t.form.last_name=s),type:"text",class:"w-full border p-2 rounded",required:""},null,512),[[b,t.form.last_name]])]),o("div",null,[e[10]||(e[10]=o("label",{class:"block text-sm font-medium text-gray-700"},"Apellido materno",-1)),c(o("input",{"onUpdate:modelValue":e[3]||(e[3]=s=>t.form.second_last_name=s),type:"text",class:"w-full border p-2 rounded",required:""},null,512),[[b,t.form.second_last_name]])]),o("div",null,[e[12]||(e[12]=o("label",{class:"block text-sm font-medium text-gray-700"},"Rol",-1)),c(o("select",{"onUpdate:modelValue":e[4]||(e[4]=s=>t.form.role=s),class:"w-full border p-2 rounded",required:""},e[11]||(e[11]=[P('<option disabled value="">Selecciona un rol</option><option value="4">RH</option><option value="2">Planning</option><option value="1">Developer</option><option value="3">Tester</option>',5)]),512),[[S,t.form.role]])]),t.isEdit?g("",!0):(i(),d("div",j,[e[13]||(e[13]=o("label",{class:"block text-sm font-medium text-gray-700"},"Contraseña",-1)),c(o("input",{"onUpdate:modelValue":e[5]||(e[5]=s=>t.form.password=s),type:"password",class:"w-full border p-2 rounded",required:""},null,512),[[b,t.form.password]])])),o("div",A,[o("button",L,p(t.isEdit?"Guardar cambios":"Crear usuario"),1)])],32)}const B=y(N,[["render",R]]),T={name:"ChangePasswordModal",props:{userId:{type:Number,required:!0}},emits:["close","success"],setup(a,{emit:e}){const n=f("");return{password:n,handleSubmit:async()=>{console.log("aa");try{const{updatePassword:r}=await E(async()=>{const{updatePassword:u}=await import("./index-CH_ZDy35.js").then(s=>s.s);return{updatePassword:u}},__vite__mapDeps([0,1]));await r(a.userId,n.value),e("success"),e("close")}catch(r){alert("Error al cambiar contraseña",r)}}}}},z={class:"bg-white p-6 rounded-lg shadow-lg w-full max-w-md relative"},G={class:"text-right mt-4"};function O(a,e,n,t,r,u){return i(),d("div",z,[e[5]||(e[5]=o("h2",{class:"text-lg font-bold mb-4"},"Cambiar contraseña",-1)),o("form",{onSubmit:e[2]||(e[2]=C((...s)=>t.handleSubmit&&t.handleSubmit(...s),["prevent"]))},[e[4]||(e[4]=o("label",{class:"block text-sm font-medium text-gray-700"},"Nueva contraseña",-1)),c(o("input",{"onUpdate:modelValue":e[0]||(e[0]=s=>t.password=s),type:"password",class:"w-full border p-2 rounded mt-1",required:""},null,512),[[b,t.password]]),o("div",G,[e[3]||(e[3]=o("button",{type:"submit",class:"bg-blue-600 text-white px-4 py-2 rounded hover:bg-blue-700"}," Guardar ",-1)),o("button",{type:"button",class:"ml-2 text-gray-500 hover:text-black",onClick:e[1]||(e[1]=s=>a.$emit("close"))}," Cancelar ")])],32)])}const H=y(T,[["render",O]]),J={name:"UsersList",components:{UserForm:B,ChangePasswordModal:H},setup(){const a=F(),e=w(()=>a.getters["users/allUsers"]),n=w(()=>a.state.users.loading),t=w(()=>a.state.users.error),r=f(!1),u=f(!1),s=f(null),x=f(null),l=()=>a.dispatch("users/fetchUsers");q(()=>{l()});const v=()=>{s.value=null,r.value=!0},M=m=>{s.value=m,r.value=!0},_=()=>{r.value=!1,s.value=null};return{users:e,loading:n,error:t,showModal:r,showPasswordModal:u,editingUser:s,selectedUserId:x,openCreateModal:v,openEditModal:M,closeModal:_,openPasswordModal:m=>{x.value=m,u.value=!0},closePasswordModal:()=>{u.value=!1,x.value=null},handleFormSubmit:async m=>{try{s.value?await a.dispatch("users/editUser",{id:s.value.id,updatedData:m}):await a.dispatch("users/createUser",m),await l(),_()}catch{alert("Error al guardar usuario")}},handleDelete:async m=>{confirm("¿Estás seguro de eliminar este usuario?")&&(await a.dispatch("users/removeUser",m),await l())},fetchUsers:l}}},K={class:"p-6"},Q={class:"flex justify-between items-center mb-4"},W={key:0,class:"text-gray-500"},X={key:1,class:"text-red-500"},Y={key:2},Z={class:"w-full bg-white shadow rounded overflow-hidden"},$={class:"px-4 py-2"},ee={class:"px-4 py-2"},te={class:"px-4 py-2"},oe={class:"px-4 py-2 text-center flex justify-center gap-2 flex-wrap"},se=["onClick"],ae=["onClick"],le=["onClick"],re={key:3,class:"fixed inset-0 bg-black/70 flex items-center justify-center z-20"},ne={class:"bg-white p-6 rounded-lg shadow-lg w-full max-w-lg relative"},de={class:"text-lg font-bold mb-4"},ie={key:4,class:"fixed inset-0 bg-black/70 flex items-center justify-center z-20"};function ue(a,e,n,t,r,u){const s=k("UserForm"),x=k("ChangePasswordModal");return i(),d("div",K,[o("div",Q,[e[2]||(e[2]=o("h1",{class:"text-2xl font-bold"},"Usuarios registrados",-1)),o("button",{onClick:e[0]||(e[0]=(...l)=>t.openCreateModal&&t.openCreateModal(...l)),class:"bg-green-600 text-white px-4 py-2 rounded hover:bg-green-700"}," + Crear usuario ")]),t.loading?(i(),d("div",W,"Cargando usuarios...")):t.error?(i(),d("div",X,p(t.error),1)):(i(),d("div",Y,[o("table",Z,[e[3]||(e[3]=o("thead",{class:"bg-gray-100 text-left text-sm uppercase"},[o("tr",null,[o("th",{class:"px-4 py-2"},"Nombre"),o("th",{class:"px-4 py-2"},"Correo"),o("th",{class:"px-4 py-2"},"Rol"),o("th",{class:"px-4 py-2 text-center"},"Acciones")])],-1)),o("tbody",null,[(i(!0),d(D,null,V(t.users,l=>(i(),d("tr",{key:l.id,class:"border-t hover:bg-gray-50"},[o("td",$,p(l.name),1),o("td",ee,p(l.email),1),o("td",te,p(l.role),1),o("td",oe,[o("button",{onClick:v=>t.openEditModal(l),class:"text-blue-600 text-sm hover:underline"}," Editar ",8,se),o("button",{onClick:v=>t.openPasswordModal(l.id),class:"text-yellow-600 text-sm hover:underline"}," Cambiar contraseña ",8,ae),o("button",{onClick:v=>t.handleDelete(l.id),class:"text-red-600 text-sm hover:underline"}," Eliminar ",8,le)])]))),128))])])])),t.showModal?(i(),d("div",re,[o("div",ne,[o("h2",de,p(t.editingUser?"Editar usuario":"Crear nuevo usuario"),1),h(s,{initialData:t.editingUser,onFormSubmit:t.handleFormSubmit},null,8,["initialData","onFormSubmit"]),o("button",{onClick:e[1]||(e[1]=(...l)=>t.closeModal&&t.closeModal(...l)),class:"absolute top-2 right-3 text-gray-600 text-xl hover:text-black"}," × ")])])):g("",!0),t.showPasswordModal?(i(),d("div",ie,[h(x,{userId:t.selectedUserId,onClose:t.closePasswordModal,onSuccess:t.fetchUsers},null,8,["userId","onClose","onSuccess"])])):g("",!0)])}const ve=y(J,[["render",ue]]);export{ve as default};
